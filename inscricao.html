<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lume - Inicie seu Teste Grátis</title>
    <link rel="icon" type="image/png" href="log.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            overflow-x: hidden;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            color: #333; 
        }
        .bg-gradient-orange {
            background: linear-gradient(135deg, #FF8C00, #FFA500);
        }
        .bg-header-gradient {
            background: linear-gradient(135deg, #FF8C00, #FFA500);
            backdrop-filter: blur(20px);
        }
        .btn-premium {
            background: linear-gradient(135deg, #FF8C00, #FFA500);
            box-shadow: 0 7px 22px rgba(255, 140, 0, 0.3);
            transition: all 0.3s ease;
        }
        .btn-premium:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(255, 140, 0, 0.4);
        }
        
        .input-field {
            border: 2px solid #e5e7eb;
            background: white;
            padding: 0.9rem 1.1rem;
            border-radius: 0.4rem;
            width: 100%;
            transition: all 0.3s ease-in-out;
            color: #374151;
            font-size: 0.9rem;
        }
        .input-field::placeholder {
            color: #9ca3af;
        }
        .input-field:focus {
            border-color: #FF8C00;
            box-shadow: 0 0 0 3px rgba(255, 140, 0, 0.1);
            outline: none;
        }

        .form-card-modern {
            background: white;
            border-radius: 1.3rem;
            box-shadow: 0 22px 45px rgba(0, 0, 0, 0.15);
            border: 1px solid #e5e7eb;
            padding: 2.7rem 2.2rem;
            color: #374151;
            position: relative;
            overflow: hidden;
        }

        .animate-pulse-slow {
            animation: pulse-slow 3s infinite ease-in-out;
        }
        @keyframes pulse-slow {
            0%, 100% {
                transform: scale(1);
                opacity: 0.8;
            }
            50% {
                transform: scale(1.03);
                opacity: 1;
            }
        }

        .info-text-section {
            padding: 1.8rem;
            margin-left: 20px;
        }
        .info-text-section h2 {
            font-size: clamp(2.2rem, 4.5vw, 3.6rem);
            font-weight: 900;
            line-height: 1.1;
            margin-bottom: 0.9rem;
            background: linear-gradient(45deg, #FF8C00, #FFA500, #FFD700);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .info-text-section > p {
            font-size: clamp(0.9rem, 1.8vw, 1rem);
            line-height: 1.6;
            color: #555;
            margin-bottom: 1.8rem;
        }

        .info-text-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 1.3rem;
            padding: 0.65rem 0;
        }
        .info-text-item span.icon {
            font-size: clamp(1.3rem, 2.7vw, 1.8rem);
            line-height: 1;
            color: #FFA500;
            margin-right: 0.9rem;
            flex-shrink: 0;
        }
        .info-text-item h3 {
            font-size: clamp(1.1rem, 2.2vw, 1.35rem);
            font-weight: 700;
            margin-bottom: 0.4rem;
            color: #333;
        }
        .info-text-item p {
            font-size: clamp(0.8rem, 1.6vw, 0.9rem);
            line-height: 1.6;
            color: #555;
        }

        .overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex; align-items: center; justify-content: center;
            z-index: 1000;
            opacity: 0; visibility: hidden;
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
        }
        .overlay.active {
            opacity: 1; visibility: visible;
        }
        .popup-card {
            background: white;
            padding: 2.2rem;
            border-radius: 1.3rem;
            text-align: center;
            max-width: 420px;
            width: 90%;
            box-shadow: 0 13px 27px rgba(0, 0, 0, 0.3);
            transform: translateY(-20px);
            opacity: 0;
            transition: transform 0.3s ease-out, opacity 0.3s ease-out;
        }
        .overlay.active .popup-card {
            transform: translateY(0); opacity: 1;
        }
        
        /* ESTILOS PARA VALIDAÇÃO */
        .password-req {
            transition: all 0.2s ease-in-out;
        }
        .req-unmet {
            color: #6b7281; /* gray-500 */
        }
        .req-met {
            color: #16a34a; /* green-600 */
            font-weight: 500;
        }
        
        /* Responsividade */
        @media (min-width: 1024px) {
            .main-content-area {
                gap: 1.8rem; 
            }
            .form-card-modern {
                margin-left: -5%;
                width: calc(34% + 70px); 
            }
            .info-text-section {
                width: calc(65% - 70px); 
                max-width: none;
            }
        }
        @media (max-width: 1919px) and (min-width: 1400px) {
            main { padding: 2rem 1rem !important; }
            .form-card-modern { padding: 2.2rem 1.8rem; }
            .info-text-section { padding: 1.5rem; margin-left: 20px; }
        }
        @media (max-width: 1399px) and (min-width: 1200px) {
            main { padding: 1.5rem 1rem !important; }
            .form-card-modern { padding: 2rem 1.6rem; }
            .info-text-section { padding: 1.2rem; margin-left: 15px; }
            .info-text-item { margin-bottom: 1rem; padding: 0.5rem 0; }
        }
        @media (max-width: 1199px) and (min-width: 1024px) {
            main { padding: 1rem !important; }
            .form-card-modern { padding: 1.8rem 1.4rem; }
            .info-text-section { padding: 1rem; margin-left: 10px; }
            .info-text-item { margin-bottom: 0.8rem; padding: 0.4rem 0; }
            .info-text-section > p { margin-bottom: 1.2rem; }
        }
        @media (max-width: 1023px) {
            .main-content-area { flex-direction: column; padding: 1rem; gap: 1.8rem; }
            .form-card-modern, .info-text-section { width: 100%; max-width: 600px; }
            .info-text-section { order: 1; text-align: center; margin-left: 0; padding: 1rem; }
            .info-text-item { flex-direction: column; align-items: center; text-align: center; }
            .info-text-item span.icon { margin-right: 0; margin-bottom: 0.5rem; }
            .form-card-modern { order: 2; padding: 1.8rem 1.3rem; }
        }
        @media (max-width: 768px) {
            main { padding: 0.5rem 1rem !important; }
            .form-card-modern { padding: 1.3rem; border-radius: 1.1rem; }
            .input-field { padding: 0.8rem 0.9rem; font-size: 0.85rem; }
            .btn-premium { padding: 0.8rem 1.3rem; font-size: 0.9rem; }
            .info-text-section { padding: 0.5rem; }
            header { padding: 0.9rem; }
            header .text-xl { font-size: 1.35rem; }
            header nav ul { gap: 0.9rem; font-size: 0.85rem; }
        }
        @media (max-width: 480px) {
            main { padding: 0.25rem 0.5rem !important; }
            .form-card-modern { padding: 1.1rem; margin: 0 0.5rem; }
            .input-field { padding: 0.65rem; font-size: 0.8rem; }
            .btn-premium { padding: 0.65rem 1.1rem; font-size: 0.85rem; }
            .info-text-section { padding: 0; margin-left: 25px; }
            header { padding: 0.65rem; }
            header .text-xl { font-size: 1.1rem; }
            header nav ul { gap: 0.5rem; font-size: 0.75rem; }
            header .w-9.h-9 { width: 1.8rem; height: 1.8rem; }
        }
        @media (max-height: 800px) and (min-width: 1024px) {
            main { padding-top: 1rem !important; padding-bottom: 1rem !important; }
            .form-card-modern { padding: 1.5rem 2.2rem; }
            .info-text-item { margin-bottom: 0.8rem; padding: 0.3rem 0; }
            .info-text-section > p { margin-bottom: 1rem; }
        }
        @media (max-height: 700px) and (min-width: 1024px) {
            main { padding: 0.5rem 4rem !important; }
            .form-card-modern { padding: 1.2rem 2rem; }
            .info-text-item { margin-bottom: 0.6rem; padding: 0.2rem 0; }
            .info-text-section h2 { margin-bottom: 0.5rem; }
            .info-text-section > p { margin-bottom: 0.8rem; }
        }
    </style>
</head>
<body class="text-gray-800 flex flex-col min-h-screen">

    <header class="bg-header-gradient shadow-xl py-3 px-5 md:px-10 flex justify-between items-center sticky top-0 z-50">
        <div class="text-xl font-bold text-white flex items-center">
            <div class="w-9 h-9 bg-white bg-opacity-20 rounded-xl flex items-center justify-center mr-3">
               <img src="log.png" alt="Lume Logo" class="w-full h-full object-cover bg-gray-600 rounded-xl p-1">
            </div>
            <a href="index.html" class="hover:text-gray-200 transition duration-300">Lume</a>
        </div>
        <nav>
            <ul class="flex space-x-5 md:space-x-8 items-center">
                <li><a href="index.html#prices" class="text-white hover:text-gray-200 font-medium transition duration-300 text-sm">Preços</a></li>
                <li><a href="index.html#contact" class="text-white hover:text-gray-200 font-medium transition duration-300 text-sm">Contatos</a></li>
                <li><a href="login.html" class="text-white hover:text-gray-200 font-medium transition duration-300 text-sm">Login</a></li>
            </ul>
        </nav>
    </header>

    <main class="flex-grow flex items-center justify-center py-12 px-4 sm:px-6 md:px-12 lg:px-16 xl:px-24"> 
        <div class="w-full flex flex-col-reverse lg:flex-row items-center lg:items-start main-content-area">
            
            <div class="flex flex-col justify-center info-text-section">
                 <h2 class="text-gray-800">Transforme sua gestão. Comece agora.</h2>
                 <p class="text-gray-600">O sistema Lume simplifica cada etapa do seu negócio, com agilidade e inteligência.</p>
 
                 <div class="info-list">
                     <div class="info-text-item">
                         <span class="icon">⚡</span>
                         <div>
                             <h3>Teste Grátis Sem Compromisso</h3>
                             <p>Comece seu teste grátis sem cadastrar cartão de crédito. Depois de 30 dias escolha seu plano e pague no Pix ou Cartão, como quiser!</p>
                         </div>
                     </div>
                     <div class="info-text-item">
                         <span class="icon">📞</span>
                         <div>
                             <h3>Suporte Humano e Ágil</h3>
                             <p>Conte com nosso suporte especializado por Email e WhatsApp, sempre que precisar sem custos adicionais!</p>
                         </div>
                     </div>
                     <div class="info-text-item">
                         <span class="icon">☁️</span>
                         <div>
                             <h3>Acesse de Onde Estiver</h3>
                             <p>Sistema 100% online. Gerencie seu negócio a qualquer hora, de qualquer lugar, com total segurança e flexibilidade.</p>
                         </div>
                     </div>
                 </div>
            </div>

            <div class="form-card-modern flex-shrink-0">
                <div class="text-center mb-7">
                    <img src="log.png" alt="Lume Logo" class="w-16 h-16 mx-auto mb-3 animate-pulse-slow p-1 bg-orange-100 rounded-xl">
                    <h2 class="text-2xl font-bold text-gray-800 mb-1">Crie sua Conta Lume</h2>
                    <p class="text-gray-600 mt-1">É simples, rápido e transparente!</p>
                </div>

                <form id="signup-form">
                    <div class="mb-3">
                        <label for="email" class="block text-gray-700 text-xs font-medium mb-1">Email</label>
                        <input type="email" id="email" class="input-field" placeholder="seuemail@exemplo.com" required autocomplete="email">
                    </div>

                    <div class="flex flex-wrap md:flex-nowrap gap-3 mb-3">
                        <div class="w-full md:w-1/2">
                            <label for="name" class="block text-gray-700 text-xs font-medium mb-1">Nome</label>
                            <input type="text" id="name" class="input-field" placeholder="Nome e Sobrenome" required autocomplete="name">
                        </div>
                        <div class="w-full md:w-1/2">
                            <label for="phone" class="block text-gray-700 text-xs font-medium mb-1">Telefone</label>
                            <input type="tel" id="phone" class="input-field" placeholder="(XX) XXXXX-XXXX" required autocomplete="tel">
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="password" class="block text-gray-700 text-xs font-medium mb-1">Senha</label>
                        <input type="password" id="password" class="input-field" placeholder="Sua senha segura" required autocomplete="new-password">
                        
                        <div class="text-xs mt-2 flex flex-wrap gap-x-4 gap-y-1">
                            <span id="length-req" class="password-req req-unmet">Mín. de 8 caracteres</span>
                            <span id="upper-req" class="password-req req-unmet">Uma letra maiúscula</span>
                            <span id="lower-req" class="password-req req-unmet">Uma letra minúscula</span>
                            <span id="number-req" class="password-req req-unmet">Um número.</span>
                        </div>

                    </div>
                    <div class="mb-5">
                        <label for="confirm-password" class="block text-gray-700 text-xs font-medium mb-1">Confirme a Senha</label>
                        <input type="password" id="confirm-password" class="input-field" placeholder="Confirme sua senha" required autocomplete="new-password">
                    </div>
                    
                    <button type="submit" class="btn-premium text-white font-bold py-2.5 px-5 rounded-full text-base w-full mb-3">
                        Criar Conta Grátis
                    </button>
                    <div id="message" class="text-center text-sm font-medium mt-3"></div>
                </form>

                <div class="text-center mt-5">
                    <p class="text-gray-600 text-sm">Já tem uma conta? <a href="login.html" class="text-orange-500 hover:underline font-semibold">Faça login aqui!</a></p>
                </div>
            </div>
        </div>
    </main>

    <footer class="bg-gray-800 text-white py-5 px-4 md:px-12 rounded-t-xl text-center">
        <div class="max-w-7xl mx-auto">
             <p class="text-gray-400 text-xs md:text-sm">&copy; 2025 Lume. Todos os direitos reservados.</p>
        </div>
    </footer>

    <div id="success-overlay" class="overlay">
       <div class="popup-card">
            <h3 class="text-green-600 text-3xl mb-3">✓</h3>
            <h2 id="popup-title" class="text-xl font-bold text-gray-800 mb-2">Cadastro Realizado!</h2>
            <p id="popup-message" class="text-gray-600 mb-5 text-sm">Um e-mail de confirmação foi enviado para o seu endereço. Por favor, verifique sua caixa de entrada e **pasta de spam** para ativar sua conta.</p>
            <button id="close-popup" class="btn-premium text-white font-bold py-2.5 px-5 rounded-full text-base">Entendi</button>
        </div>
    </div>

    <script>
    const SUPABASE_URL = 'https://gnehkswoqlpchtlgyjyj.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImduZWhrc3dvcWxwY2h0bGd5anlqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM4OTY3NjYsImV4cCI6MjA2OTQ3Mjc2Nn0.8giA1bDvCzgvlcW_pkimGO9qHRF2I0QfhG6nx9U_tdY';

    let supabaseClient;

    window.addEventListener('load', () => {
        if (typeof supabase === 'undefined') {
            showMessage('❌ Erro de conexão. Recarregue a página ou verifique sua internet.', 'text-red-500');
        }
    });

    try {
        supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    } catch (error) {
        console.error('Erro ao inicializar Supabase:', error);
        showMessage('❌ Erro de inicialização. Recarregue a página.', 'text-red-500');
    }

    const signupForm = document.getElementById('signup-form');
    const nameInput = document.getElementById('name');
    const phoneInput = document.getElementById('phone');
    const emailInput = document.getElementById('email');
    const passwordInput = document.getElementById('password');
    const confirmPasswordInput = document.getElementById('confirm-password');
    const messageDiv = document.getElementById('message');
    const successOverlay = document.getElementById('success-overlay');
    const popupTitle = document.getElementById('popup-title');
    const popupMessage = document.getElementById('popup-message');
    const closePopupButton = document.getElementById('close-popup');

    // Elementos para os requisitos da senha
    const lengthReq = document.getElementById('length-req');
    const upperReq = document.getElementById('upper-req');
    const lowerReq = document.getElementById('lower-req');
    const numberReq = document.getElementById('number-req');
    
    // CÓDIGO DE VALIDAÇÃO DE SENHA (NÃO PRECISA DE ALTERAÇÃO)
    passwordInput.addEventListener('input', validatePassword);

    function validatePassword() {
        const password = passwordInput.value;
        let allValid = true;

        // Regra 1: Mínimo de 8 caracteres
        if (password.length >= 8) {
            lengthReq.classList.replace('req-unmet', 'req-met');
        } else {
            lengthReq.classList.replace('req-met', 'req-unmet');
            allValid = false;
        }

        // Regra 2: Pelo menos 1 letra maiúscula
        if (/[A-Z]/.test(password)) {
            upperReq.classList.replace('req-unmet', 'req-met');
        } else {
            upperReq.classList.replace('req-met', 'req-unmet');
            allValid = false;
        }

        // Regra 3: Pelo menos 1 letra minúscula
        if (/[a-z]/.test(password)) {
            lowerReq.classList.replace('req-unmet', 'req-met');
        } else {
            lowerReq.classList.replace('req-met', 'req-unmet');
            allValid = false;
        }

        // Regra 4: Pelo menos 1 número
        if (/[0-9]/.test(password)) {
            numberReq.classList.replace('req-unmet', 'req-met');
        } else {
            numberReq.classList.replace('req-met', 'req-unmet');
            allValid = false;
        }
        
        return allValid;
    }

    // --- RESTANTE DO CÓDIGO ORIGINAL ---

    function showSuccessPopup(title, msg) {
        popupTitle.innerHTML = title;
        popupMessage.innerHTML = msg;
        successOverlay.classList.add('active');
    }

    closePopupButton.addEventListener('click', () => {
        successOverlay.classList.remove('active');
    });

    function generateCompanyId() {
        const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
        let result = '';
        for (let i = 0; i < 10; i++) {
            result += chars.charAt(Math.floor(Math.random() * chars.length));
        }
        return result;
    }

    async function saveUserData(authUserId, userData) {
        try {
            const companyId = generateCompanyId();
            
            const { data, error } = await supabaseClient
                .from('user')
                .insert([
                    {
                        nome: userData.name,
                        telefone: userData.phone,
                        email: userData.email,
                        funcao: 'empreendedor',
                        id_empresa: companyId,
                        auth_user_id: authUserId, 
                        created_at: new Date().toISOString()
                    }
                ]);

            if (error) {
                console.error('Erro ao salvar dados do usuário:', error);
                throw error;
            }
            return data;
        } catch (error) {
            console.error('Erro na função saveUserData:', error);
            throw error;
        }
    }

    signupForm.addEventListener('submit', async (event) => {
        event.preventDefault();
        
        showMessage('', '');

        const name = nameInput.value.trim();
        const phone = phoneInput.value.trim();
        const email = emailInput.value.trim();
        const password = passwordInput.value;
        const confirmPassword = confirmPasswordInput.value;

        if (!name || !phone) {
            showMessage('Por favor, preencha seu nome e telefone.', 'text-red-500');
            return;
        }

        if (password !== confirmPassword) {
            showMessage('As senhas não coincidem.', 'text-red-500');
            return;
        }

        const isPasswordValid = validatePassword();
        if (!isPasswordValid) {
            showMessage('A senha não atende a todos os requisitos de segurança.', 'text-red-500');
            return;
        }

        showMessage('Criando sua conta...', 'text-orange-500');

        try {
            if (typeof supabaseClient === 'undefined' || !supabaseClient) {
                throw new Error('Erro de conexão: Supabase não carregado. Verifique sua conexão com a internet.');
            }
            
            const { data: authData, error: authError } = await supabaseClient.auth.signUp({
                email: email,
                password: password,
                options: {
                    emailRedirectTo: window.location.origin + '/login.html',
                    data: {
                        full_name: name,
                        phone: phone,
                        created_at: new Date().toISOString()
                    }
                },
            });

            if (authError) {
                throw authError;
            }

            if (authData.user) {
                try {
                    await saveUserData(authData.user.id, {
                        name: name,
                        phone: phone,
                        email: email
                    });
                } catch (saveError) {
                    console.error('Erro ao salvar dados na tabela user:', saveError);
                }
            }

            if (authData.user && authData.session) {
                showSuccessPopup(
                    'Bem-vindo(a) à Lume!', 
                    'Sua conta foi criada e você já está logado(a)! Redirecionando para o painel...'
                );
                signupForm.reset();
                validatePassword();
                setTimeout(() => {
                    window.location.href = 'nova-venda.html'; 
                }, 3000);
            } else if (authData.user && !authData.session) {
                showSuccessPopup(
                    'Cadastro Realizado!', 
                    'Um e-mail de confirmação foi enviado. Verifique sua caixa de entrada e <b>pasta de spam</b> para ativar sua conta.'
                );
                signupForm.reset();
                validatePassword();
            } else {
                showSuccessPopup(
                    'Processo Iniciado!',
                    'Seu cadastro foi recebido. Verifique seu e-mail para os próximos passos.'
                );
                signupForm.reset();
                validatePassword();
            }

        } catch (error) {
            console.error('Erro ao cadastrar:', error.message);

            if (error.message.includes('Supabase não carregado')) {
                showMessage('❌ Erro de conexão. Verifique sua internet e tente novamente.', 'text-red-500');
            } else if (error.message.includes('User already registered')) {
                showMessage('❌ Este email já está cadastrado. Tente fazer login.', 'text-red-500');
            } else if (error.message.includes('rate limit exceeded')) {
                showMessage('❌ Muitas tentativas. Aguarde e tente novamente.', 'text-red-500');
            } else if (error.message.includes('Network')) {
                showMessage('❌ Erro de conexão. Verifique sua internet e tente novamente.', 'text-red-500');
            } else {
                showMessage(`❌ Erro: ${error.message}. Tente novamente.`, 'text-red-500');
            }
        }
    });

    function showMessage(text, colorClass) {
        messageDiv.textContent = text;
        messageDiv.className = `text-center text-sm font-medium mt-3 ${colorClass}`;
    }
    </script>
</body>
</html>